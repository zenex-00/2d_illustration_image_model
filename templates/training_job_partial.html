<div id="job-status-container" 
     {% if job.status != 'completed' and job.status != 'failed' %}
     hx-get="/ui/training/jobs/{{ job.job_id }}/status" 
     hx-trigger="every 3s"
     hx-swap="innerHTML"
     hx-on::htmx:response-error="console.error('Status update failed'); this.setAttribute('hx-trigger', 'none');"
     {% endif %}>
    <div id="job-status">
        <span class="status-badge status-{{ job.status }}">{{ job.status }}</span>
        <span>Progress: {{ "%.1f"|format(job.progress|default(0)) }}%</span>
        {% if job.current_epoch|default(0) > 0 %}
        <span>Epoch: {{ job.current_epoch }}/{{ job.total_epochs }}</span>
        {% endif %}
        {% if job.train_loss %}
        <span>Train Loss: {{ "%.4f"|format(job.train_loss) }}</span>
        {% endif %}
        {% if job.val_loss %}
        <span>Val Loss: {{ "%.4f"|format(job.val_loss) }}</span>
        {% endif %}
    </div>
    
    <div class="phase-indicators">
        <div class="phase phase-{{ 'active' if job.phase_status.get('phase1_status') == 'processing' else 'complete' if job.phase_status.get('phase1_status') == 'completed' else 'pending' }}">
            <span>Phase 1: Semantic Sanitization</span>
            <span class="phase-progress">{{ job.phase_status.get('phase1_progress', '0/0') }}</span>
        </div>
        <div class="phase phase-{{ 'active' if job.phase_status.get('phase2_status') == 'processing' else 'complete' if job.phase_status.get('phase2_status') == 'completed' else 'pending' }}">
            <span>Phase 2: Preprocessing</span>
            <span class="phase-progress">{{ job.phase_status.get('phase2_progress', '0/0') }}</span>
        </div>
        <div class="phase phase-{{ 'active' if job.status == 'processing' and job.phase_status.get('phase2_status') == 'completed' else 'complete' if job.status == 'completed' else 'pending' }}">
            <span>Training: LoRA Training</span>
        </div>
    </div>
    
    {% if job.logs and job.logs|length > 0 %}
    {% set last_log = job.logs[-1] %}
    {% if 'Phase' in last_log or 'Removing background' in last_log or 'Generating depth' in last_log or 'Detecting edges' in last_log %}
    <div class="current-operation">
        {{ last_log|e }}
    </div>
    {% endif %}
    {% endif %}
    
    <div class="log-container">
        {% for log in job.logs|default([]) %}
        <div class="log-line">{{ log|e }}</div>
        {% endfor %}
    </div>
</div>

